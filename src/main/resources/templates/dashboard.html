<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ATM - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/TransactionController.js" defer></script>
</head>
<body>
<nav class="navbar navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand" href="#">ATM Banking</a>
        <a href="/logout" class="btn btn-outline-light">Đăng xuất</a>
    </div>
</nav>

<div class="container mt-4">
    <p>Chào mừng, <span th:if="${user != null}" th:text="${user.fullName}">Nguyễn Văn A</span></p>
    <p>Số dư hiện tại:
        <strong th:if="${user != null and user.accounts != null and not #lists.isEmpty(user.accounts)}"
                th:text="${user.accounts[0].balance} + ' VND'">
        </strong>
        <strong th:unless="${user != null and user.accounts != null and not #lists.isEmpty(user.accounts)}">0 VND</strong>
    </p>

    <div class="row">
        <div class="col-md-4">
            <button class="btn btn-success w-100" data-bs-toggle="modal" data-bs-target="#depositModal">Nạp tiền</button>
        </div>
        <div class="col-md-4">
            <button class="btn btn-danger w-100" data-bs-toggle="modal" data-bs-target="#withdrawModal">Rút tiền</button>
        </div>
        <div class="col-md-4">
            <a href="/transactions" class="btn btn-warning w-100">Lịch sử giao dịch</a>
        </div>
    </div>
</div>

<!-- Modal Nạp Tiền -->
<div class="modal fade" id="depositModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Nạp Tiền</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form th:action="@{/transactions/deposit}" method="post">
                    <input type="hidden" name="accountId" th:if="${not #lists.isEmpty(user.accounts)}" th:value="${user.accounts[0].id}">
                    <label for="depositAmount">Số tiền:</label>
                    <input type="number" name="amount" id="depositAmount" class="form-control" required>
                    <button type="submit" class="btn btn-success mt-3">Xác nhận</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal Rút Tiền -->
<div class="modal fade" id="withdrawModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Rút Tiền</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form th:action="@{/transactions/withdraw}" method="post">
                    <input type="hidden" name="accountId" th:if="${not #lists.isEmpty(user.accounts)}" th:value="${user.accounts[0].id}">
                    <label for="withdrawAmount">Số tiền:</label>
                    <input type="number" name="amount" id="withdrawAmount" class="form-control" required>
                    <button type="submit" class="btn btn-danger mt-3">Xác nhận</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal Chuyển Tiền -->
<div class="modal fade" id="transferModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Chuyển Tiền</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form th:action="@{/transactions/transfer}" method="post">
                    <input type="hidden" name="fromAccountId" th:if="${not #lists.isEmpty(user.accounts)}" th:value="${user.accounts[0].id}">

                    <label for="toAccountNumberModal">Tài khoản đích:</label>
                    <input type="text" class="form-control" id="toAccountNumberModal" name="toAccountNumber" required>

                    <label for="transferAmountModal">Số tiền:</label>
                    <input type="number" class="form-control" id="transferAmountModal" name="amount" required>

                    <button type="submit" class="btn btn-primary mt-3">Xác nhận</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Nút mở modal chuyển tiền -->
<div class="col-md-4">
    <button class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#transferModal">Chuyển tiền</button>
</div>

</body>
</html>
